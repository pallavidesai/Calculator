<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="public/js/frondend.js"></script>
    <style>
    * { font-family:tahoma; font-size:12px; padding:0px;margin:0px;}
    #status { width:88px;display:block;float:left;margin-top:15px; }
         input[type="button"] 
         { 
         background-color:#F2F3F4; 
         height: 30px; 
         width:100% 
         }   
         input[type="text"] 
         { 
         background-color:white; 
         height: 30px; 
         width:100% 
         } 
  </style>
  <script>
    $(function () {
  // for better performance - to avoid searching in DOM
  var content = $('#content');
  var input = $('#input');
  var status = $('#status');
  // my color assigned by the server
  var myColor = false;
  // my name sent to the server
  var myName = false;
  // if user is running mozilla then use it's built-in WebSocket
  window.WebSocket = window.WebSocket || window.MozWebSocket;
  // if browser doesn't support WebSocket, just show
  // some notification and exit
  if (!window.WebSocket) {
    content.html($('<p>',
      { text:'Sorry, but your browser doesn\'t support WebSocket.'}
    ));
    input.hide();
    $('span').hide();
    return;
  }
  // open connection
  //var HOST = location.origin.replace(/^http/, 'ws');
  var connection = new WebSocket('ws://127.0.0.1:8081');
  connection.onopen = function () {
    // first we want users to enter their names
    input.removeAttr('disabled');
    status.text('');
  };
  connection.onerror = function (error) {
    // just in there were some problems with connection...
    content.html($('<p>', {
      text: 'Sorry, but there\'s some problem with your '
         + 'connection or the server is down.'
    }));
  };
  // most important part - incoming messages
  connection.onmessage = function (message) {
    // try to parse JSON message. Because we know that the server
    // always returns JSON this should work without any problem but
    // we should make sure that the massage is not chunked or
    // otherwise damaged.
    try {
      var json = JSON.parse(message.data);
    } catch (e) {
      console.log('Invalid JSON: ', message.data);
      return;
    }
    // NOTE: if you're not sure about the JSON structure
    // check the server source code above
    // first response from the server with user's color
    if (json.type === 'color') { 
      myColor = json.data;
      status.text(myName + ': ').css('color', myColor);
      input.removeAttr('disabled').focus();
      // from now user can start sending messages
    } else if (json.type === 'history') { // entire message history
      // insert every single message to the chat window
      for (var i=0; i < json.data.length; i++) {
      addMessage(json.data[i].author, json.data[i].text,
          json.data[i].color, new Date(json.data[i].time));
      }
    } else if (json.type === 'message') { // it's a single message
      // let the user write another message
      input.removeAttr('disabled'); 
      addMessage(json.data.author, json.data.text,
                 json.data.color, new Date(json.data.time));
    } else {
      console.log('Hmm..., I\'ve never seen JSON like this:', json);
    }
  };
  /**
   * Send message when user presses Enter key
   */
  input.change(function() {
      var msg = document.getElementById("input").value;
      // send the message as an ordinary text
      connection.send(msg);
      $(this).val('');
      // disable the input field to make the user wait until server
      // sends back response
      input.attr('disabled', 'disabled');
      // we know that the first message sent from a user their name
      if (myName === false) {
        myName = msg;
      }
  });
  /**
   * This method is optional. If the server wasn't able to
   * respond to the in 3 seconds then show some error message 
   * to notify the user that something is wrong.
   */
  setInterval(function() {
    if (connection.readyState !== 1) {
      status.text('Error');
      input.attr('disabled', 'disabled').val(
          'Unable to communicate with the WebSocket server.');
    }
  }, 3000);
  /**
   * Add message to the chat window
   */
  function addMessage(author, message, color, dt) {
    content.prepend('<p><span style="color:' + color + '">'
        + author + '</span> @ ' + (dt.getHours() < 10 ? '0'
        + dt.getHours() : dt.getHours()) + ':'
        + (dt.getMinutes() < 10
          ? '0' + dt.getMinutes() : dt.getMinutes())
        + ': ' + message + '</p>');
  }
});
  </script>
  </head>
  <body>
    <div class="container">
      <h2>Welcome to Shared Calculator</h2>
      <br><br>
      <div class="form-group">
        <label for="name">Enter You Name:</label>
        <input type="name" class="form-control" id="name" placeholder="Enter name" name="name">
        <button type="button" class="btn btn-primary">Primary</button>
      </div>
    </div>
   
    <div id="content" class="container p-3 my-3 border"></div>
    <div>
      <span id="status">Connecting...</span>
      <input type="hidden" id="input" disabled="disabled" />
    <table class="container p-3 my-3 border"> 
      <tr> 
         <td colspan="3"><input type="text" id="result"/></td> 
         <!-- clr() function will call clr to clear all value -->
         <td><input type="button" value="c" onclick="clr()"/> </td> 
      </tr> 
      <tr> 
         <!-- create button and assign value to each button -->
         <!-- dis("1") will call function dis to display value -->
         <td><input type="button" value="1" onclick="dis('1')"/> </td> 
         <td><input type="button" value="2" onclick="dis('2')"/> </td> 
         <td><input type="button" value="3" onclick="dis('3')"/> </td> 
         <td><input type="button" value="/" onclick="dis('/')"/> </td> 
      </tr> 
      <tr> 
         <td><input type="button" value="4" onclick="dis('4')"/> </td> 
         <td><input type="button" value="5" onclick="dis('5')"/> </td> 
         <td><input type="button" value="6" onclick="dis('6')"/> </td> 
         <td><input type="button" value="-" onclick="dis('-')"/> </td> 
      </tr> 
      <tr> 
         <td><input type="button" value="7" onclick="dis('7')"/> </td> 
         <td><input type="button" value="8" onclick="dis('8')"/> </td> 
         <td><input type="button" value="9" onclick="dis('9')"/> </td> 
         <td><input type="button" value="+" onclick="dis('+')"/> </td> 
      </tr> 
      <tr> 
         <td><input type="button" value="." onclick="dis('.')"/> </td> 
         <td><input type="button" value="0" onclick="dis('0')"/> </td> 
         <!-- solve function call function solve to evaluate value -->
         <td><input type="button" value="=" onclick="solve()"/> </td> 
         <td><input type="button" value="*" onclick="dis('*')"/> </td> 
      </tr> 
   </table> 
  </div>
  </body>
</html>